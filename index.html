<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pesquisa de Satisfação</title>
  <style>
    :root{--bg:#0f172a;--panel:#111827;--muted:#94a3b8;--accent:#6366f1}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:linear-gradient(135deg,#0f172a,#111827);color:#e5e7eb;min-height:100vh;display:grid;place-items:start;padding:24px}
    .wrap{width:100%;max-width:780px;margin:0 auto;background:rgba(17,24,39,.92);border:1px solid rgba(255,255,255,.06);border-radius:18px;box-shadow:0 16px 40px rgba(0,0,0,.35);padding:22px}
    h1{margin:0 0 6px;font-size:clamp(22px,3vw,28px)}
    p.subtitle{margin:0 0 18px;color:var(--muted)}
    fieldset{border:1px solid #263042;border-radius:14px;margin:14px 0 18px;padding:14px}
    legend{padding:0 8px;color:#cbd5e1}
    label{display:block;margin:10px 0 6px;font-weight:600;color:#cbd5e1}
    input[type="text"],input[type="email"],textarea,select,input[type="date"],input[type="number"]{
      width:100%;padding:12px 14px;border-radius:12px;border:1px solid #374151;background:#0b1220;color:#e5e7eb;outline:none
    }
    textarea{min-height:110px;resize:vertical}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .radios,.radios-inline{display:flex;gap:10px;flex-wrap:wrap}
    .note{font-size:12px;color:var(--muted)}
    .btn{margin-top:12px;width:100%;padding:12px 16px;border:none;border-radius:12px;background:var(--accent);color:white;font-weight:700;cursor:pointer}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .alert{margin-top:12px;padding:10px 12px;border-radius:10px;display:none}
    .alert.ok{background:#0f3f2a;border:1px solid #1ea971}
    .alert.err{background:#3a1120;border:1px solid #d14b6a}
    footer{margin-top:10px;text-align:center;font-size:12px;color:#93a1b7}
    a{color:#a5b4fc}
  </style>
</head>
<body>
  <main class="wrap">
    <h1>Pesquisa de Satisfação</h1>
    <p class="subtitle">Sua opinião é essencial para melhorarmos continuamente.</p>

    <form id="survey">
      <fieldset>
        <legend>Identificação (opcional)</legend>
        <div class="grid-2">
          <div>
            <label for="nome">Nome</label>
            <input id="nome" name="nome" type="text" placeholder="Seu nome" />
          </div>
          <div>
            <label for="email">Email</label>
            <input id="email" name="email" type="email" placeholder="voce@exemplo.com" />
          </div>
        </div>
        <div class="grid-2">
          <div>
            <label for="projeto">Projeto / Serviço</label>
            <input id="projeto" name="projeto" type="text" placeholder="Ex.: Implementação IA / Contrato XYZ" required />
          </div>
          <div>
            <label for="dataRef">Data de referência</label>
            <input id="dataRef" name="dataRef" type="date" />
          </div>
        </div>
      </fieldset>

      <fieldset>
        <legend>Métricas</legend>
        <label>Quão provável é recomendar nossos serviços? (NPS)</label>
        <div class="radios-inline" role="radiogroup" aria-label="NPS">
          <div class="radios">
            <label><input type="radio" name="nps" value="0" required />0</label>
            <label><input type="radio" name="nps" value="1" />1</label>
            <label><input type="radio" name="nps" value="2" />2</label>
            <label><input type="radio" name="nps" value="3" />3</label>
            <label><input type="radio" name="nps" value="4" />4</label>
            <label><input type="radio" name="nps" value="5" />5</label>
            <label><input type="radio" name="nps" value="6" />6</label>
            <label><input type="radio" name="nps" value="7" />7</label>
            <label><input type="radio" name="nps" value="8" />8</label>
            <label><input type="radio" name="nps" value="9" />9</label>
            <label><input type="radio" name="nps" value="10" />10</label>
          </div>
        </div>

        <label for="satisfacao">Satisfação geral</label>
        <select id="satisfacao" name="satisfacao" required>
          <option value="" disabled selected>Selecione…</option>
          <option value="1">1 - Muito insatisfeito</option>
          <option value="2">2 - Insatisfeito</option>
          <option value="3">3 - Neutro</option>
          <option value="4">4 - Satisfeito</option>
          <option value="5">5 - Muito satisfeito</option>
        </select>

        <div class="grid-2">
          <div>
            <label for="qualidade">Qualidade da entrega</label>
            <select id="qualidade" name="qualidade" required>
              <option value="" disabled selected>Selecione…</option>
              <option value="1">1 - Muito ruim</option>
              <option value="2">2 - Ruim</option>
              <option value="3">3 - Regular</option>
              <option value="4">4 - Boa</option>
              <option value="5">5 - Excelente</option>
            </select>
          </div>
          <div>
            <label for="tempoResposta">Tempo de resposta</label>
            <select id="tempoResposta" name="tempoResposta" required>
              <option value="" disabled selected>Selecione…</option>
              <option value="1">1 - Muito lento</option>
              <option value="2">2 - Lento</option>
              <option value="3">3 - Ok</option>
              <option value="4">4 - Rápido</option>
              <option value="5">5 - Muito rápido</option>
            </select>
          </div>
        </div>

        <label>Você recomendaria nossos serviços?</label>
        <div class="radios" role="radiogroup" aria-label="Recomendaria">
          <label><input type="radio" name="recomendaria" value="sim" required /> Sim</label>
          <label><input type="radio" name="recomendaria" value="nao" /> Não</label>
        </div>
      </fieldset>

      <fieldset>
        <legend>Feedback</legend>
        <label for="pontosPositivos">O que funcionou bem?</label>
        <textarea id="pontosPositivos" name="pontosPositivos" placeholder="Conte o que mais gostou…"></textarea>

        <label for="oQueMelhorar">O que podemos melhorar?</label>
        <textarea id="oQueMelhorar" name="oQueMelhorar" placeholder="Sugestões objetivas ajudam muito…"></textarea>

        <label for="observacoes">Observações adicionais</label>
        <textarea id="observacoes" name="observacoes" placeholder="Informações complementares (opcional)…"></textarea>

        <label class="note"><input type="checkbox" id="consent" required /> Autorizo o uso dos dados desta pesquisa para fins de melhoria de serviços.</label>
        <div class="note">Ao enviar, os dados são enviados em JSON para o seu webhook.</div>
      </fieldset>

      <button id="btnSubmit" class="btn" type="submit">Enviar feedback</button>
      <div id="ok" class="alert ok">Obrigado! Sua resposta foi enviada com sucesso. ✅</div>
      <div id="err" class="alert err">Não foi possível enviar agora. Tente novamente mais tarde. ❌</div>
    </form>

    <footer>Hospedado em GitHub Pages • <a href="./">voltar ao início</a></footer>
  </main>

  <!-- Script de envio -->
  <script>
    function genId(){
      if (crypto && crypto.randomUUID) return crypto.randomUUID();
      return 'id-' + Math.random().toString(36).slice(2) + Date.now();
    }

    const form = document.getElementById('survey');
    const btn  = document.getElementById('btnSubmit');
    const okEl = document.getElementById('ok');
    const errEl= document.getElementById('err');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      okEl.style.display = 'none';
      errEl.style.display = 'none';
      btn.disabled = true;
      btn.textContent = 'Enviando…';

      const data = new FormData(form);
      const payload = {
        meta: {
          id: genId(),
          timestamp: new Date().toISOString(),
          pageUrl: location.href,
          userAgent: navigator.userAgent
        },
        resposta: {
          nome: data.get('nome') || null,
          email: data.get('email') || null,
          projeto: data.get('projeto'),
          dataRef: data.get('dataRef') || null,
          nps: data.get('nps') !== null ? Number(data.get('nps')) : null,
          satisfacao: Number(data.get('satisfacao')),
          qualidade: Number(data.get('qualidade')),
          tempoResposta: Number(data.get('tempoResposta')),
          recomendaria: data.get('recomendaria'),
          pontosPositivos: data.get('pontosPositivos') || null,
          oQueMelhorar: data.get('oQueMelhorar') || null,
          observacoes: data.get('observacoes') || null,
          consent: document.getElementById('consent').checked
        }
      };

      try {
        const res = await fetch('https://radixie.radixeng.com.br/webhook/pqs', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        okEl.style.display = 'block';
        form.reset();
      } catch (err) {
        console.error('Falha ao enviar:', err);
        errEl.style.display = 'block';
      } finally {
        btn.disabled = false;
        btn.textContent = 'Enviar feedback';
      }
    });
  </script>

  <!-- Script de prefill -->
  <script>
    (function prefillFromQuery(){
      function ready(fn){
        if (document.readyState !== 'loading') fn();
        else document.addEventListener('DOMContentLoaded', fn);
      }
      ready(() => {
        const params = new URLSearchParams(window.location.search);
        const map = {
          nome: 'nome',
          email: 'email',
          projeto: 'projeto',
          dataRef: 'dataRef',
          nps: 'nps',
          satisfacao: 'satisfacao',
          qualidade: 'qualidade',
          tempoResposta: 'tempoResposta',
          recomendaria: 'recomendaria',
          pontosPositivos: 'pontosPositivos',
          oQueMelhorar: 'oQueMelhorar',
          observacoes: 'observacoes'
        };
        function setRadio(name, value){
          const radios = document.querySelectorAll(`input[type="radio"][name="${name}"]`);
          for (const r of radios) {
            if (String(r.value) === String(value)) { r.checked = true; return r; }
          }
          return null;
        }
        function lock(el){
          if (!el) return;
          const tag = el.tagName.toLowerCase();
          if (tag === 'select') el.disabled = true;
          else el.readOnly = true;
          el.dataset.prefilled = "1";
        }
        for (const [qName, field] of Object.entries(map)) {
          if (!params.has(qName)) continue;
          const val = params.get(qName);
          if (qName === 'nps' || qName === 'recomendaria') {
            const r = setRadio(field, val);
            if (r) lock(r);
            continue;
          }
          const select = document.getElementById(field);
          if (select && select.tagName === 'SELECT') {
            const opt = [...select.options].find(o => String(o.value) === String(val));
            if (opt) { select.value = opt.value; lock(select); }
            continue;
          }
          const input = document.getElementById(field) || document.querySelector(`[name="${field}"]`);
          if (input) { input.value = val; lock(input); }
        }
        console.log('Prefill params →', Object.fromEntries(params.entries()));
      });
    })();
  </script>
</body>
</html>
